let recaptchaWidgetId,recaptchaOrderWidgetId;function setCookie(e,t,n){const o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);const a="expires="+o.toUTCString();document.cookie=e+"="+t+";"+a+";path=/"}function getCookie(e){const t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let o=n[e].trim();if(0===o.indexOf(t))return o.substring(t.length,o.length)}return""}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("cookieConsent"),t=document.getElementById("acceptCookiesBtn"),n=document.getElementById("rejectCookiesBtn"),o=document.getElementById("cookieMsg"),a=document.getElementById("cookieOrderMsg"),d=document.getElementById("data-form"),c=document.getElementById("orderForm");let l=!1;function i(){d.style.display="flex",c.style.display="flex",o.style.display="none",a.style.display="none"}function s(){d.style.display="none",c.style.display="none",o.style.display="block",a.style.display="block"}function r(){if(!l){const e=document.createElement("script");e.src="https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit",e.async=!0,e.defer=!0,document.body.appendChild(e),l=!0}}window.onRecaptchaLoad=function(){console.log("reCAPTCHA loaded successfully.");const e=document.getElementById("recaptcha-container"),t=document.getElementById("recaptcha-container-order");e&&(recaptchaWidgetId=grecaptcha.render(e,{sitekey:"6LeNBt0qAAAAAOkMEYknDVLtPCkhhSo7Fc4gh-r_"})),t&&(recaptchaOrderWidgetId=grecaptcha.render(t,{sitekey:"6LeNBt0qAAAAAOkMEYknDVLtPCkhhSo7Fc4gh-r_"}))},t.addEventListener("click",(function(){localStorage.setItem("cookieConsent","accepted"),e.style.display="none",i(),r()})),n.addEventListener("click",(function(){localStorage.removeItem("cookieConsent"),e.style.display="none",s()})),document.getElementById("showFormButton").addEventListener("click",(function(){localStorage.getItem("cookieConsent")?i():s()})),localStorage.getItem("cookieConsent")?(i(),r()):(e.style.display="block",s())})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("showMenuButton"),t=document.getElementById("menuModal"),n=document.getElementById("closeMenuBtn");e.onclick=function(){t.style.display="block"},n.onclick=function(){t.style.display="none"},window.onclick=function(e){e.target==t&&(t.style.display="none")};const o={Glutine:{className:"glutine",emoji:"🌾"},Latte:{className:"latte",emoji:"🥛"},Uova:{className:"uova",emoji:"🥚"},"Frutta a guscio":{className:"frutta-a-guscio",emoji:"🌰"},Arachidi:{className:"arachidi",emoji:"🥜"},Soia:{className:"soia",emoji:"🌱"},Pesce:{className:"pesce",emoji:"🐟"},Crostacei:{className:"crostacei",emoji:"🦐"},Molluschi:{className:"molluschi",emoji:"🐚"},Sedano:{className:"sedano",emoji:"🥬"},Lupini:{className:"lupini",emoji:"🌼"},Sesamo:{className:"sesamo",emoji:"⚪"},Senape:{className:"senape",emoji:"🟡"},Solfiti:{className:"solfiti",emoji:"⚗️"}};Promise.all([fetch("categories.json").then((e=>e.json())),fetch("clean_products.json").then((e=>e.json()))]).then((([e,t])=>{const n=document.getElementById("generatedContentMenu");e.payload.categories.forEach((e=>{const a=document.createElement("button");a.classList.add("collapsible"),a.textContent=e.title,n.appendChild(a);const d=document.createElement("div");d.classList.add("menu-grid","content"),n.appendChild(d),e.items_assoc.forEach((e=>{const n=t.products.find((t=>t.id===e.product_id));if(n){const e=document.createElement("div");e.classList.add("menu-item");const t=document.createElement("h1");t.classList.add("product-title");const a=document.createElement("p");if(a.classList.add("product-price"),n.title.toLowerCase().includes("green")){const e=document.createElement("i");e.classList.add("fas","fa-leaf"),e.style.marginLeft="10px",t.appendChild(e)}t.prepend(document.createTextNode(n.title)),a.textContent=`${parseFloat(n.price).toFixed(2).toString().replace(".",",")}€`;const c=document.createElement("img");c.classList.add("product-img"),c.src=n.thumb,c.loading="lazy";const l=document.createElement("p");if(l.classList.add("product-description"),l.textContent=n.ingredients,e.appendChild(c),e.appendChild(t),e.appendChild(l),e.appendChild(a),n.allergens){const t=document.createElement("div");t.classList.add("allergeni-container");const a=document.createElement("p");a.classList.add("allergeni-text"),a.textContent="Allergeni",t.appendChild(a),listallergeni=n.allergens;const d=listallergeni.split(", "),c=document.createElement("div");c.classList.add("allergeni-inner-container"),t.appendChild(c),d.forEach((e=>{const t=o[e];if(t){const e=document.createElement("div");e.className=`icona ${t.className}`,e.textContent=t.emoji,c.appendChild(e)}})),e.appendChild(t)}d.appendChild(e)}}))}))})).catch((e=>{console.error("Error loading the files:",e)})),document.addEventListener("click",(function(e){if(e.target.classList.contains("collapsible")){const t=e.target;t.classList.toggle("active");const n=t.nextElementSibling;n.classList.toggle("open"),n.style.maxHeight?n.style.maxHeight=null:n.style.maxHeight=n.scrollHeight+50+"px"}}));const a=document.getElementById("open-map-modal"),d=document.getElementById("inactive-modal"),c=document.getElementById("close-inactive-modal");a.addEventListener("click",(e=>{(function(){const e=a.getAttribute("href");return!(!e||"#"===e)||(d.style.display="block",!1)})()||e.preventDefault()})),c.addEventListener("click",(()=>{d.style.display="none"})),window.addEventListener("click",(e=>{e.target===d&&(d.style.display="none")}));const l=document.getElementById("showClockButton"),i=document.getElementById("clockModal"),s=document.getElementById("closeClockBtn");l.onclick=function(){i.style.display="block"},s.onclick=function(){i.style.display="none"},window.onclick=function(e){e.target==i&&(i.style.display="none")};const r=document.getElementById("showFormButton"),m=document.getElementById("membershipModal"),u=document.getElementById("closeMembershipBtn");r.onclick=function(){m.style.display="flex"},u.onclick=function(){m.style.display="none"},window.onclick=function(e){e.target==m&&(m.style.display="none")};const p=getCookie("barcodeData");p&&(JsBarcode("#barcode",p,{format:"ean13",lineColor:"#000",width:2,height:100,displayValue:!0}),document.getElementById("result").style.display="block",document.getElementById("downloadBarcodeButton").style.display="block",document.getElementById("data-form").style.display="none");const y=document.getElementById("submit-button"),g=document.getElementById("result"),E=document.getElementById("data-form");E.addEventListener("submit",(async e=>{e.preventDefault();if(!grecaptcha.getResponse(recaptchaWidgetId))return void alert("Completa il reCAPTCHA.");y.disabled=!0;const t=new FormData(E);t.set("email",t.get("email").toLowerCase());const n=new Date(t.get("dob")),o=new Date,a=o.getFullYear()-n.getFullYear();if(a<16||16===a&&o<new Date(n.setFullYear(n.getFullYear()+16))||a>100)return alert("Devi avere almeno 16 anni per iscriverti."),void(y.disabled=!1);const d=`+39${t.get("phone")}`,c=Object.fromEntries(t.entries());c.phone=d,console.log(JSON.stringify(c));try{const e=await fetch("https://api.cicciosburger.it/api/generate-barcode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!e.ok){const t=await e.text();return alert("Errore: "+t),void(y.disabled=!1)}const t=await e.text();setCookie("barcodeData",t,30),JsBarcode("#barcode",t,{format:"ean13",lineColor:"#000",width:2,height:100,displayValue:!0}),E.style.display="none",g.style.display="block",document.getElementById("downloadBarcodeButton").style.display="block"}catch(e){alert("Errore: "+e.message)}finally{y.disabled=!1}})),document.getElementById("downloadBarcodeButton").addEventListener("click",(function(){const e=document.getElementById("barcode");console.log("Barcode Element:",e);const t=e;t?setTimeout((()=>{const e=document.createElement("canvas"),n=e.getContext("2d"),o=(new XMLSerializer).serializeToString(t),a=new Image;a.src="data:image/svg+xml;base64,"+btoa(o),a.onload=function(){e.width=a.width,e.height=a.height,n.drawImage(a,0,0);const t=document.createElement("a");t.href=e.toDataURL("image/png"),t.download="barcode.png",t.click()}}),100):alert("Il codice a barre non è stato generato correttamente.")}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("orderModal"),t=document.getElementById("showOrderFormButton"),n=document.querySelector(".close"),o=document.getElementById("addToCart"),a=document.getElementById("sendOrder"),d=document.getElementById("cart");let c=[],l={};function i(){const e=document.getElementById("order-type"),t=document.getElementById("order-size");t.innerHTML="";const n=e.value;l[n]&&l[n].sizes.forEach((e=>{let n=document.createElement("option");n.value=e.toLowerCase(),n.textContent=e,t.appendChild(n)}))}function s(){d.innerHTML="",c.forEach(((e,t)=>{let n=document.createElement("div");n.classList.add("itemDiv");let o=document.createElement("p");o.classList.add("itemQuantity"),o.textContent=`${e.quantity}`;let a=document.createElement("div");a.classList.add("itemInternalDiv");let l=document.createElement("p");l.classList.add("itemTitle"),l.textContent=e.type;let i=document.createElement("p");i.classList.add("itemSize"),i.textContent=`Taglia: ${e.size}`;let r=document.createElement("p");r.classList.add("itemPrice");const m=(e.quantity*e.price).toFixed(2);r.textContent=`Prezzo: ${m}€`;let u=document.createElement("button");u.textContent="Rimuovi",u.classList.add("remove"),u.addEventListener("click",(()=>{c.splice(t,1),s()})),a.appendChild(l),a.appendChild(i),a.appendChild(r),n.appendChild(o),n.appendChild(a),n.appendChild(u),d.appendChild(n)}))}t.addEventListener("click",(()=>{e.style.display="block"})),n.addEventListener("click",(()=>{e.style.display="none"})),window.addEventListener("click",(t=>{t.target===e&&(e.style.display="none")})),fetch("data.json").then((e=>e.json())).then((e=>{l=e;const t=document.getElementById("order-type");t.innerHTML="",Object.keys(l).forEach((e=>{let n=document.createElement("option");n.value=e;const o=l[e].price.toFixed(2);n.textContent=`${e.charAt(0).toUpperCase()+e.slice(1)} - ${o}€`,t.appendChild(n)})),i()})),document.getElementById("order-type").addEventListener("change",i),o.addEventListener("click",(()=>{const e=document.getElementById("order-name").value,t=document.getElementById("order-surname").value,n=document.getElementById("order-email").value,o=(document.getElementById("order-shop").value,parseInt(document.getElementById("order-quantity").value)),a=document.getElementById("order-type").value,d=document.getElementById("order-size").value;if(!e||!t||!n||isNaN(o)||o<1||o>5)return void alert("Compila tutti i campi correttamente.");let i=!1;if(c=c.map((e=>e.type===a&&e.size===d?(i=!0,{...e,quantity:Math.min(e.quantity+o,5)}):e)),!i){const e=l[a].price;c.push({quantity:o,type:a,size:d,price:e})}s()})),a.addEventListener("click",(async()=>{if(0===c.length)return void alert("Il carrello è vuoto!");const e=grecaptcha.getResponse(recaptchaOrderWidgetId);if(!e)return void alert("Completa il reCAPTCHA.");const t=document.getElementById("order-name").value,n=document.getElementById("order-surname").value,o=document.getElementById("order-email").value,d=document.getElementById("order-shop").value;if(!t||!n||!o)return void alert("Compila tutti i campi obbligatori.");a.disabled=!0,a.textContent="Invio in corso...";const l={name:t,surname:n,email:o,shop:d,cart:c,recaptchaResponse:e};try{const e=await fetch("https://api.cicciosburger.it/api/generate-order-number",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!e.ok)throw new Error("Errore nell'invio dell'ordine.");const t=await e.text();document.getElementById("orderContainer").style.display="none";const n=document.getElementById("confirmationMessage");document.getElementById("orderNumberDisplay").textContent=t,n.style.display="block";document.getElementById("newOrderButton").addEventListener("click",(()=>{document.getElementById("orderContainer").style.display="block",document.getElementById("confirmationMessage").style.display="none",c=[],s()}))}catch(e){console.error("Errore nell'invio dell'ordine:",e),alert("Si è verificato un errore durante l'invio dell'ordine. Riprova più tardi.")}finally{a.disabled=!1,a.textContent="Invia Ordine"}}))}));